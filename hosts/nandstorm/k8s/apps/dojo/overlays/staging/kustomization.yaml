apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: dojo-staging

resources:
# Uses the upstream Dojo base; assumes deploy/k8s/base exists in the Dojo repo.
- github.com/blogle/dojo//deploy/k8s/base?ref=master
- namespace.yaml
- volumes.yaml
- ingress.yaml

images:
- name: ghcr.io/blogle/dojo
  newName: ghcr.io/blogle/dojo
  newTag: staging

patches:
- target:
    group: ""
    version: v1
    kind: PersistentVolumeClaim
    name: dojo-data
    namespace: dojo-staging
  patch: |-
    - op: replace
      path: /spec/volumeName
      value: dojo-staging-pv
    - op: replace
      path: /spec/storageClassName
      value: ""
- path: keel-annotations.patch.yaml
- path: pod-spec.patch.yaml
